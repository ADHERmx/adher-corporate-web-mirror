name: Mirror Repository

on:
  push:
    branches:
      - '**'  # Trigger on push to any branch

jobs:
  mirror:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout source repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch all history for all branches
          fetch-tags: false  # Don't fetch tags as requested

      - name: Configure Git
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"

      - name: Set up mirror remote
        env:
          MIRROR_TOKEN: ${{ secrets.MIRROR_REPO_TOKEN }}
        run: |
          # Add mirror repository as remote
          git remote add mirror https://x-access-token:${MIRROR_TOKEN}@github.com/ADHERmx/adher-corporate-web-mirror.git

          # Fetch all branches from mirror (if it exists)
          git fetch mirror --prune || true

      - name: Push all branches to mirror
        run: |
          # Push all branches to mirror with force to ensure exact sync
          git push mirror --all --force

          echo "âœ… Successfully mirrored all branches to ADHERmx/adher-corporate-web-mirror"

      - name: Mirror summary
        run: |
          echo "Repository mirroring complete!"
          echo "Source: Acabados-Adher-SA-de-CV/adher-corporate-web"
          echo "Mirror: ADHERmx/adher-corporate-web-mirror"
          echo "Branches synced:"
          git branch -r | grep 'origin/' | sed 's/origin\///' | sed 's/^/  - /'
